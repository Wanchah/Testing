{% extends "base.html" %}

{% block content %}
<div class="chat-container">
    <div class="chat-header">
        <h1>ü§ñ AI Learning Assistant</h1>
        <p>Ask questions, get explanations, and receive personalized learning support from our AI tutor.</p>
    </div>

    <div class="chat-interface">
        <div class="chat-messages" id="chatMessages">
            <div class="message ai-message">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">AI Tutor</span>
                        <span class="message-time">Just now</span>
                    </div>
                    <div class="message-text">
                        Hello! I'm your AI learning assistant. I can help you with:
                        <ul>
                            <li>üìö Explaining difficult concepts</li>
                            <li>üßÆ Solving math problems step-by-step</li>
                            <li>üî¨ Clarifying scientific principles</li>
                            <li>üìù Writing and grammar help</li>
                            <li>üéØ Study strategies and tips</li>
                        </ul>
                        What would you like to learn about today?
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-area">
            <form id="chatForm" class="chat-form">
                <div class="input-group">
                    <select id="context" name="context" class="context-select">
                        <option value="general">General Learning</option>
                        <option value="mathematics">Mathematics</option>
                        <option value="science">Science</option>
                        <option value="history">History</option>
                        <option value="literature">Literature</option>
                        <option value="language">Language Arts</option>
                        <option value="computer_science">Computer Science</option>
                        <option value="study_tips">Study Tips</option>
                    </select>
                    
                    <div class="message-input-container">
                        <textarea id="messageInput" name="message" 
                                  placeholder="Ask me anything about your studies..." 
                                  rows="3" required></textarea>
                        <button type="submit" class="send-button" id="sendButton">
                            <span class="send-icon">üì§</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="chat-features">
        <h3>üí° Quick Questions</h3>
        <div class="quick-questions">
            <button class="quick-question" onclick="askQuickQuestion('How can I improve my study habits?')">
                üìö Study Habits
            </button>
            <button class="quick-question" onclick="askQuickQuestion('Explain the Pythagorean theorem')">
                üìê Math Help
            </button>
            <button class="quick-question" onclick="askQuickQuestion('What is photosynthesis?')">
                üå± Science Help
            </button>
            <button class="quick-question" onclick="askQuickQuestion('How to write a good essay?')">
                ‚úçÔ∏è Writing Help
            </button>
        </div>
    </div>

    <div class="chat-tips">
        <h3>üí≠ Tips for Better AI Responses</h3>
        <div class="tips-grid">
            <div class="tip">
                <div class="tip-icon">üéØ</div>
                <h4>Be Specific</h4>
                <p>Instead of "Help with math", try "Explain quadratic equations step by step"</p>
            </div>
            <div class="tip">
                <div class="tip-icon">üìù</div>
                <h4>Show Your Work</h4>
                <p>Share what you've tried so far to get more targeted help</p>
            </div>
            <div class="tip">
                <div class="tip-icon">üîç</div>
                <h4>Ask Follow-ups</h4>
                <p>Don't hesitate to ask for clarification or examples</p>
            </div>
            <div class="tip">
                <div class="tip-icon">üìö</div>
                <h4>Use Context</h4>
                <p>Select the right subject area for more relevant responses</p>
            </div>
        </div>
    </div>
</div>

<script>
let isProcessing = false;

// Chat form handling
document.getElementById('chatForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (isProcessing) return;
    
    const messageInput = document.getElementById('messageInput');
    const message = messageInput.value.trim();
    const context = document.getElementById('context').value;
    
    if (!message) return;
    
    // Add user message to chat
    addMessage('user', message, context);
    
    // Clear input
    messageInput.value = '';
    
    // Show typing indicator
    showTypingIndicator();
    
    // Send to AI (simulate for now)
    setTimeout(() => {
        hideTypingIndicator();
        const aiResponse = getAIResponse(message, context);
        addMessage('ai', aiResponse, context);
    }, 2000);
});

// Add message to chat
function addMessage(sender, text, context) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}-message`;
    
    const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    if (sender === 'user') {
        messageDiv.innerHTML = `
            <div class="message-content">
                <div class="message-header">
                    <span class="message-sender">You</span>
                    <span class="message-time">${timestamp}</span>
                </div>
                <div class="message-text">${text}</div>
            </div>
            <div class="message-avatar">üë§</div>
        `;
    } else {
        messageDiv.innerHTML = `
            <div class="message-avatar">ü§ñ</div>
            <div class="message-content">
                <div class="message-header">
                    <span class="message-sender">AI Tutor</span>
                    <span class="message-time">${timestamp}</span>
                </div>
                <div class="message-text">${text}</div>
            </div>
        `;
    }
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Show typing indicator
function showTypingIndicator() {
    const chatMessages = document.getElementById('chatMessages');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'message ai-message typing-indicator';
    typingDiv.id = 'typingIndicator';
    typingDiv.innerHTML = `
        <div class="message-avatar">ü§ñ</div>
        <div class="message-content">
            <div class="message-header">
                <span class="message-sender">AI Tutor</span>
                <span class="message-time">Typing...</span>
            </div>
            <div class="message-text">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    `;
    
    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Hide typing indicator
function hideTypingIndicator() {
    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

// Quick question function
function askQuickQuestion(question) {
    document.getElementById('messageInput').value = question;
    document.getElementById('chatForm').dispatchEvent(new Event('submit'));
}

// Simulate AI response (replace with actual API call)
function getAIResponse(message, context) {
    const responses = {
        'mathematics': [
            "Let me help you with that math problem! I'll break it down step by step...",
            "Great question! In mathematics, this concept works by...",
            "Here's how to approach this mathematical problem..."
        ],
        'science': [
            "Excellent question! In science, this phenomenon occurs because...",
            "Let me explain this scientific concept in simple terms...",
            "This is a fascinating scientific principle that works by..."
        ],
        'general': [
            "That's a great question! Let me explain this concept...",
            "I'd be happy to help you understand this topic...",
            "Here's what you need to know about this subject..."
        ]
    };
    
    const contextResponses = responses[context] || responses['general'];
    const randomResponse = contextResponses[Math.floor(Math.random() * contextResponses.length)];
    
    return randomResponse + " " + generateDetailedResponse(message);
}

function generateDetailedResponse(message) {
    if (message.toLowerCase().includes('study')) {
        return "For effective studying, I recommend using techniques like spaced repetition, active recall, and the Pomodoro method. Would you like me to explain any of these in detail?";
    } else if (message.toLowerCase().includes('math')) {
        return "When solving math problems, always start by understanding what's being asked, identify the relevant formulas, and work through the solution step by step. Practice is key!";
    } else if (message.toLowerCase().includes('science')) {
        return "In science, it's important to understand the underlying principles, not just memorize facts. Try to connect concepts and ask 'why' questions to deepen your understanding.";
    } else {
        return "This is a great topic to explore! I'd recommend breaking it down into smaller parts and practicing regularly. Is there a specific aspect you'd like me to focus on?";
    }
}

// Auto-resize textarea
document.getElementById('messageInput').addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = this.scrollHeight + 'px';
});
</script>

<style>
.chat-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem;
}

.chat-header {
    text-align: center;
    margin-bottom: 2rem;
}

.chat-header h1 {
    font-size: 2.5rem;
    color: #1f2937;
    margin-bottom: 1rem;
}

.chat-header p {
    color: #6b7280;
    font-size: 1.125rem;
}

.chat-interface {
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    overflow: hidden;
    margin-bottom: 2rem;
}

.chat-messages {
    height: 500px;
    overflow-y: auto;
    padding: 1.5rem;
    background: #f8fafc;
}

.message {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    animation: fadeIn 0.3s ease-in;
}

.user-message {
    flex-direction: row-reverse;
}

.message-avatar {
    font-size: 2rem;
    flex-shrink: 0;
}

.message-content {
    flex: 1;
    max-width: 70%;
}

.message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.message-sender {
    font-weight: 600;
    color: #374151;
}

.message-time {
    font-size: 0.75rem;
    color: #9ca3af;
}

.message-text {
    background: white;
    padding: 1rem;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    line-height: 1.6;
}

.user-message .message-text {
    background: #4f46e5;
    color: white;
}

.typing-indicator .message-text {
    background: white;
    padding: 1rem 1.5rem;
}

.typing-dots {
    display: flex;
    gap: 0.25rem;
}

.typing-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #9ca3af;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(1) { animation-delay: -0.32s; }
.typing-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
    0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
    40% { transform: scale(1); opacity: 1; }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.chat-input-area {
    padding: 1.5rem;
    background: white;
    border-top: 1px solid #e5e7eb;
}

.chat-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.input-group {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.context-select {
    padding: 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1rem;
    max-width: 200px;
}

.message-input-container {
    display: flex;
    gap: 0.5rem;
    align-items: flex-end;
}

#messageInput {
    flex: 1;
    padding: 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1rem;
    resize: none;
    min-height: 60px;
    max-height: 120px;
}

#messageInput:focus {
    outline: none;
    border-color: #4f46e5;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.send-button {
    background: #4f46e5;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem;
    cursor: pointer;
    transition: background 0.2s ease;
    min-width: 50px;
    height: 60px;
}

.send-button:hover {
    background: #4338ca;
}

.send-icon {
    font-size: 1.25rem;
}

.chat-features {
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    padding: 2rem;
    margin-bottom: 2rem;
}

.chat-features h3 {
    color: #1f2937;
    margin-bottom: 1.5rem;
    text-align: center;
}

.quick-questions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
}

.quick-question {
    background: #f3f4f6;
    border: 2px solid #e5e7eb;
    border-radius: 20px;
    padding: 0.75rem 1.5rem;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.875rem;
}

.quick-question:hover {
    background: #4f46e5;
    color: white;
    border-color: #4f46e5;
    transform: translateY(-2px);
}

.chat-tips {
    background: #f8fafc;
    border-radius: 20px;
    padding: 2rem;
}

.chat-tips h3 {
    color: #1f2937;
    margin-bottom: 1.5rem;
    text-align: center;
}

.tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.tip {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.tip-icon {
    font-size: 2rem;
    margin-bottom: 1rem;
}

.tip h4 {
    color: #1f2937;
    margin-bottom: 0.5rem;
}

.tip p {
    color: #6b7280;
    font-size: 0.875rem;
    line-height: 1.5;
}

@media (max-width: 768px) {
    .chat-container {
        padding: 1rem;
    }
    
    .chat-messages {
        height: 400px;
    }
    
    .message-content {
        max-width: 85%;
    }
    
    .quick-questions {
        flex-direction: column;
        align-items: center;
    }
    
    .tips-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
